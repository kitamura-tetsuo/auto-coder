[pytest]
# Collect tests only from our main test suite
testpaths =
    tests

# Test discovery patterns
python_files =
    test_*.py
    *_test.py
python_classes =
    Test*
python_functions =
    test_*

# Test markers for categorizing tests
markers =
    unit: Unit tests - fast, isolated tests for individual components
    integration: Integration tests - tests that verify component interactions
    performance: Performance tests - tests that measure execution time and resource usage
    error: Error handling tests - tests for error conditions and edge cases
    compatibility: Backward compatibility tests - tests for maintaining compatibility with older versions
    label: Label-based tests - tests specifically for label-based prompt functionality
    slow: Slow tests - tests that take more than 5 seconds to run

# Filter warnings for test-specific scenarios
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::pytest.PytestUnraisableExceptionWarning

# Default options
addopts =
    --tb=short
    --disable-warnings
    --ignore=./utils/
    --ignore=./mcp/
    --ignore=./.venv/
    --ignore=./rm/
    --ignore=./mcp-inspector-config/
    --ignore=simple_mcp_test.py
    --ignore=integration_test.py
    --ignore=comprehensive_type_checker.py
    --ignore=fix_test_failures.py
    --ignore=mcp_detailed_test_client.py
    --ignore=mcp_test_client.py
    --ignore=mcp_test_server.py
    --ignore=proxy_status.sh
    --ignore=tcp_proxy.py
    --ignore=monitor_proxy.sh
    --ignore=start_proxy.sh
    --ignore=backward_compatibility_check.py
    --ignore=pyproject.toml
    --ignore=test_backward_compatibility.py
    --ignore=test_cli_integration.py
    --ignore=test_fix_validation.py
    --ignore=test_github_actions_check.py
    --ignore=test_github_actions_history_fallback.py
    --ignore=test_graphrag_mcp.py
    --ignore=test_message_backend_integration.py
    --ignore=test_only_graphrag.py
    --ignore=test_output.txt
    --ignore=./src/auto_coder/graph_builder/
    --ignore=test_progress_decorators.py
    --ignore=test_pull_conflict_fix.py
    --ignore=type_checking_utils.py

# Parallel test execution settings
# Use pytest-xdist for parallel execution: pytest -n auto
# Default is to run tests sequentially for stability
# Set PYTEST_XDIST_AUTO=1 to enable automatic parallelization

verbosity = 2