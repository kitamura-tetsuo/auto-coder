# Test prompt template for bug issues
# This template includes specialized instructions for bug fixes

header: |
  Read AGENTS.md before proceeding if you haven't read it yet.

issue:
  bug: |
    You are processing a GitHub issue with the 'bug' label.

    BUG FIX REQUIREMENTS:
    - This issue reports a bug or defect in existing functionality
    - Focus on identifying root cause and implementing proper fix
    - Add or update tests to prevent regression
    - Verify the fix resolves the reported issue
    - Consider edge cases and related scenarios

    Issue Context:
    Repository: $repo_name
    Issue #$issue_number: $issue_title
    Labels: $issue_labels
    Issue Type: BUG FIX

    Issue Description:
    $issue_body...

    Commit History Since Branch Creation:
    $commit_log

    BRANCH NAMING: If you need to create new branches for any reason, always use the 'issue-<number>' naming convention (e.g., 'issue-123'). NEVER use branches with 'pr-<number>' pattern. This convention is enforced by the system and any attempt to create pr-xx branches will fail.

    DEPENDENCY HANDLING: If this issue mentions "Depends on: #123" or similar dependency references in its body, ensure that any related issues are properly linked. If this issue is a dependency for other issues, update those issues' bodies to reference this one if you proceed.

    BUG FIX DIRECTIVES:
    1. ROOT CAUSE ANALYSIS: Identify the underlying cause of the bug
    2. PROPER FIX: Implement a fix that addresses the root cause, not just symptoms
    3. REGRESSION TESTS: Add tests that would have caught this bug
    4. EDGE CASES: Consider and test related edge cases
    5. VERIFICATION: Verify the fix resolves the reported issue completely

    DEBUGGING APPROACH:
    - Reproduce the bug to understand the failure mode
    - Trace through the code to identify the root cause
    - Consider why existing tests didn't catch this
    - Implement fix with comprehensive test coverage
    - Verify fix doesn't introduce new issues

    Please analyze this bug report and determine the appropriate action:

    1. If you need clarification or reproduction steps, add a comment requesting more information
    2. If this is not actually a bug (working as intended), close it with an appropriate explanation
    3. If this is a duplicate of another issue, close it with a reference to the original
    4. If this is a valid bug, provide analysis and implementation

    For valid bugs:
    - Analyze the bug report and reproduce the issue if possible
    - Identify the root cause in the codebase
    - Implement the necessary code changes to fix the bug
    - Add or update tests to prevent regression
    - Ensure the implementation follows best practices
    - Keep open the issue
    - All tests were passed in the main branch. If tests are failing, it is because of the changes.

    After taking action, respond with a summary of what you did.

    Please proceed with analyzing and fixing this bug now.

pr:
  bug: |
    You are operating directly in the repository workspace with write access and the git and gh CLIs available.

    Task: For the following GitHub Pull Request with the 'bug' label, apply safe code changes directly to make it mergeable and passing. Never post PR comments.

    STRICT DIRECTIVES (follow exactly):
    - All tests were passed in the main branch before the PR was created. If the PR is failing tests, it is because of the PR changes. Fix the PR changes.
    - Do NOT post any comments to the PR, reviews, or issues.
    - Do NOT write narrative explanations as output; take actions in the workspace instead.
    - Prefer targeted edits that make CI pass while preserving intent.
    - After edits, run quick local checks if available (linters/fast unit tests) to sanity-verify.
    - Do NOT run git commit/push; the system will handle committing.
    - If you cannot deterministically fix the PR, stop without posting comments and print only: CANNOT_FIX

    BUG FIX PR REQUIREMENTS:
    - This PR fixes a bug or defect in existing functionality
    - Focus on identifying root cause and implementing proper fix
    - Add or update tests to prevent regression
    - Verify the fix resolves the reported issue
    - Consider edge cases and related scenarios

    PR Context:
    Repository: $repo_name
    PR #$pr_number: $pr_title

    PR Description:
    $pr_body...

    PR Changes:
    $pr_diff

    Commit History Since Branch Creation:
    $commit_log


    BUG FIX PR DIRECTIVES:
    1. ROOT CAUSE ANALYSIS: Identify the underlying cause of the bug
    2. PROPER FIX: Implement a fix that addresses the root cause, not just symptoms
    3. REGRESSION TESTS: Add tests that would have caught this bug
    4. EDGE CASES: Consider and test related edge cases
    5. VERIFICATION: Verify the fix resolves the reported issue completely

    DEBUGGING APPROACH:
    - Reproduce the bug to understand the failure mode
    - Trace through the code to identify the root cause
    - Consider why existing tests didn't catch this
    - Implement fix with comprehensive test coverage
    - Verify fix doesn't introduce new issues

    Return format:
    - Print a single line starting with: ACTION_SUMMARY: <brief summary of files changed and whether merged>
    - No greetings, no multi-paragraph analysis.

    Please proceed with analyzing and fixing this PR now.
