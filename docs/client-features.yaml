version: "2025.11.5+g26724bf"
project:
  name: auto-coder
  description: Automated application development with multi-backend LLM CLI and GitHub integration
  python: ">=3.11,<3.12"
  entry_point: auto-coder
  repository_paths:
    - "mcp/graphrag_mcp"  # path to bundled GraphRAG MCP fork

cli:
  binary: auto-coder
  commands:
    - name: process-issues
      purpose: Process GitHub issues and PRs using AI backends; optionally only label issues in Jules mode
      options:
        - { name: --repo, type: string, default: auto-detect from current git repo, env: null }
        - { name: --github-token, type: string, env: GITHUB_TOKEN, default: null }
        - { name: --backend, multiple: true, default: [codex], choices: [codex, codex-mcp, gemini, qwen, auggie, claude] }
        - { name: --message-backend, multiple: true, default: same as --backend, choices: [codex, codex-mcp, gemini, qwen, auggie, claude] }
        - { name: --gemini-api-key, env: GEMINI_API_KEY }
        - { name: --openai-api-key, env: OPENAI_API_KEY }
        - { name: --openai-base-url, env: OPENAI_BASE_URL }
        - { name: --qwen-use-env-vars/--qwen-use-cli-options, default: false }
        - { name: --qwen-preserve-env/--qwen-clear-env, default: false }
        - { name: --model-gemini, type: string }
        - { name: --model-qwen, type: string }
        - { name: --model-auggie, type: string }
        - { name: --model-claude, type: string }
        - { name: --dry-run, flag: true, default: false }
        - { name: --jules-mode/--no-jules-mode, default: true }
        - { name: --disable-labels/--no-disable-labels, default: auto-detect (disabled in debugger) }
        - { name: --skip-main-update/--no-skip-main-update, default: true }
        - { name: --ignore-dependabot-prs/--no-ignore-dependabot-prs, default: false }
        - { name: --force-clean-before-checkout/--no-force-clean-before-checkout, default: false }
        - { name: --enable-graphrag/--disable-graphrag, default: true }
        - { name: --only, type: string, help: "PR/Issue URL or number" }
        - { name: --force-reindex, flag: true, default: false }
        - { name: --log-level, choices: [DEBUG, INFO, WARNING, ERROR, CRITICAL], default: INFO }
        - { name: --log-file, type: path }
        - { name: --verbose, flag: true }
      behavior:
        - Initializes GraphRAG when enabled (auto-setup + MCP config check)
        - Resumes work on current non-main branch by detecting an open PR/issue
        - Prioritizes candidates: urgent label (3) > auto-mergeable PRs (2) > failing PRs (1) > issues (0)
        - Skips issues if 5+ open issues without sub-issues are found in a batch
        - Saves JSON reports under ~/.auto-coder/{owner_repo}/
        - Honors skip-main-update policy (default: skip merging base branch before fixes)
    - name: create-feature-issues
      purpose: Analyze repository and create feature enhancement issues via LLM
      options:
        - { name: --repo, type: string, default: auto-detect }
        - { name: --github-token, env: GITHUB_TOKEN }
        - { name: --backend, multiple: true, default: [codex], choices: [codex, codex-mcp, gemini, qwen, auggie, claude] }
        - { name: --gemini-api-key, env: GEMINI_API_KEY }
        - { name: --openai-api-key, env: OPENAI_API_KEY }
        - { name: --openai-base-url, env: OPENAI_BASE_URL }
        - { name: --qwen-use-env-vars/--qwen-use-cli-options, default: true }
        - { name: --qwen-preserve-env/--qwen-clear-env, default: false }
        - { name: --model-gemini }
        - { name: --model-qwen }
        - { name: --model-auggie }
        - { name: --model-claude }
        - { name: --enable-graphrag/--disable-graphrag, default: true }
        - { name: --force-reindex, flag: true, default: false }
        - { name: --log-level, default: INFO }
        - { name: --log-file }
        - { name: --verbose, flag: true }
      behavior:
        - Initializes GraphRAG (optional) and checks MCP configuration
        - Uses prompts to propose structured feature issues with labels/acceptance criteria
    - name: fix-to-pass-tests
      purpose: Run local tests and iteratively apply LLM fixes until tests pass
      options:
        - { name: --backend, multiple: true, default: [codex], choices: [codex, codex-mcp, gemini, qwen, auggie, claude] }
        - { name: --message-backend, multiple: true, default: same as --backend }
        - { name: --gemini-api-key, env: GEMINI_API_KEY }
        - { name: --openai-api-key, env: OPENAI_API_KEY }
        - { name: --openai-base-url, env: OPENAI_BASE_URL }
        - { name: --qwen-use-env-vars/--qwen-use-cli-options, default: true }
        - { name: --qwen-preserve-env/--qwen-clear-env, default: false }
        - { name: --model-gemini }
        - { name: --model-qwen }
        - { name: --model-auggie }
        - { name: --model-claude }
        - { name: --max-attempts, type: int, default: null (engine default applies) }
        - { name: --enable-graphrag/--disable-graphrag, default: true }
        - { name: --dry-run, flag: true, default: false }
        - { name: --force-reindex, flag: true, default: false }
        - { name: --log-level, default: INFO }
        - { name: --log-file }
        - { name: --verbose, flag: true }
      behavior:
        - Executes scripts/test.sh (never calls pytest directly)
        - If LLM makes no edits in an iteration, stops with error
        - Supports separate message backends for summarization/communication
    - name: get-actions-logs
      purpose: Fetch and print error blocks from a GitHub Actions job URL
      options:
        - { name: --url, required: true }
        - { name: --github-token, env: GITHUB_TOKEN }
    - name: auth-status
      purpose: Print authentication and CLI availability status for GitHub, Gemini, Qwen, Auggie
  groups:
    - name: graphrag
      description: Manage Neo4j + Qdrant and the GraphRAG MCP server
      subcommands:
        - name: start
          options:
            - { name: --wait/--no-wait, default: true }
            - { name: --timeout, type: int, default: 120 }
        - name: stop
          options:
            - { name: --timeout, type: int, default: 60 }
        - name: status
        - name: update-index
          options:
            - { name: --force, flag: true }
            - { name: --repo-path, type: path }
        - name: setup-mcp
          options:
            - { name: --install-dir, default: "~/graphrag_mcp" }
            - { name: --neo4j-uri, default: "bolt://localhost:7687" }
            - { name: --neo4j-user, default: "neo4j" }
            - { name: --neo4j-password, default: "password" }
            - { name: --qdrant-url, default: "http://localhost:6333" }
            - { name: --skip-clone, flag: true }
            - { name: --backends, multiple: true, choices: [codex, gemini, qwen, windsurf] }
    - name: mcp
      description: Install and inspect MCP servers
      subcommands:
        - { name: setup <server_name>, options: [--install-dir, --force] }
        - { name: list }
        - { name: status <server_name> }
        - { name: test <server_name> }
    - name: mcp-pdb
      description: Helpers for MCP-PDB setup
      subcommands:
        - { name: print-config, options: [--target (windsurf|claude), --write-to] }
        - { name: status }

features:
  github_automation:
    - Candidate collection with priority ordering (urgent PR/Issue > mergeable PRs > failing PRs > issues)
    - Skips issues when 5+ open issues without sub-issues are present
    - Single-item processing via --only (URL or number)
    - Auto-resume when on a non-main branch with an associated PR/Issue
  fix_loop:
    - Re-run tests and apply LLM fixes until success or max attempts
    - Default max attempts (engine): 30
    - No-op edit detection halts the loop with error
  backends:
    supported: [codex, codex-mcp, gemini, qwen, auggie, claude]
    rotation:
      description: "BackendManager rotates across configured backends; switches after 3 consecutive runs on same test file"
    message_backend:
      description: Separate backends can be used for message generation
  graphrag_integration:
    auto_setup: true
    mcp_config_check: true
    index_update: available via CLI
  logging:
    library: loguru
    console: colored, includes file:function:line with trimmed project-relative paths
    file: rotation 10 MB, retention 7 days, zip compression
  reports:
    path: "~/.auto-coder/{owner_repo}/automation_report_*.json"

config:
  automation_config:
    REPORTS_DIR: "reports"
    TEST_SCRIPT_PATH: "scripts/test.sh"
    MAX_PR_DIFF_SIZE: 2000
    MAX_PROMPT_SIZE: 1000
    MAX_RESPONSE_SIZE: 200
    MAX_FIX_ATTEMPTS: 30
    MAIN_BRANCH: "main"
    SKIP_MAIN_UPDATE_WHEN_CHECKS_FAIL: true
    IGNORE_DEPENDABOT_PRS: false
    FORCE_CLEAN_BEFORE_CHECKOUT: false
    DISABLE_LABELS: false
    SEARCH_GITHUB_ACTIONS_HISTORY: true
    ENABLE_ACTIONS_HISTORY_FALLBACK: true
    MERGE_METHOD: "--squash"
    MERGE_AUTO: true

env:
  GITHUB_TOKEN: GitHub API token for API and gh CLI operations
  GEMINI_API_KEY: API key for Gemini when using gemini backend
  OPENAI_API_KEY: OpenAI-compatible API key for qwen backend
  OPENAI_BASE_URL: OpenAI-compatible base URL for qwen backend
  AUTO_CODER_QWEN_CONFIG: Override path to qwen-providers.toml
  AUTO_CODER_CONFIG_DIR: Directory that contains qwen-providers.toml

external_dependencies:
  graphrag:
    services: [neo4j, qdrant]
    docker_compose_file: docker-compose.graphrag.yml
  graphrag_mcp:
    type: "CUSTOMIZED FORK"
    path: "mcp/graphrag_mcp"
    specialized_for: "TypeScript/JavaScript code analysis"
    tools: [find_symbol, get_call_graph, get_dependencies, impact_analysis, semantic_code_search]
    notes: "Bundled fork replaces generic documentation search with code analysis tools."
  qwen_providers_config:
    file: "~/.auto-coder/qwen-providers.toml"
    defaults:
      modelstudio: { base_url: "https://dashscope-intl.aliyuncs.com/compatible-mode/v1", model: "qwen3-coder-plus" }
      openrouter: { base_url: "https://openrouter.ai/api/v1", model: "qwen/qwen3-coder:free" }
    env_override:
      - AUTO_CODER_QWEN_CONFIG  # full path override
      - AUTO_CODER_CONFIG_DIR   # directory override

