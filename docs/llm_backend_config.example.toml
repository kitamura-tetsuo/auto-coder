# Auto-Coder LLM Backend Configuration
# This file configures the LLM backends used by the application
#
# Configuration location: ~/.auto-coder/llm_config.toml

[backend]
# Default backend to use for LLM operations (default: codex)
default = "gemini"

# Order in which to try backends for LLM operations
# If not specified, all enabled backends will be used in alphabetical order
order = ["gemini", "qwen", "auggie", "claude", "codex", "codex-mcp"]

[message_backend]
# Default backend for message generation (commit messages, PR messages, etc.)
default = "qwen"

# Order in which to try backends for message generation
# If not specified, will fall back to the general backend order
order = ["qwen", "gemini", "auggie"]

# Individual backend configurations
[backends.gemini]
enabled = true
model = "gemini-2.5-pro"
api_key = "your-gemini-api-key"  # Optional: can be set via GEMINI_API_KEY env var

# Provider list for this backend (optional)
# Providers are different implementations/connections for the same backend
# Configure multiple providers to enable automatic provider rotation
# Format: providers = ["provider-name-1", "provider-name-2", "provider-name-3"]
# Example: ["gemini-direct", "gemini-via-proxy", "gemini-backup"]
# Note: Provider definitions are stored separately in ~/.auto-coder/provider_metadata.toml
providers = []

[backends.qwen]
enabled = true
model = "qwen3-coder-plus"
openai_api_key = "your-openai-api-key"  # Optional: can be set via OPENAI_API_KEY env var
openai_base_url = "https://api.openai.com/v1"  # Optional: can be set via OPENAI_BASE_URL env var

# Provider list for this backend
# Configure multiple providers for automatic failover and rotation
# Example providers:
#   - "qwen-open-router": Qwen via OpenRouter API (good for free tier)
#   - "qwen-azure": Qwen via Azure OpenAI (enterprise-grade)
#   - "qwen-direct": Direct Qwen API access (fastest)
# Rotation order follows the list order: first → second → third → first...
providers = ["qwen-open-router", "qwen-azure", "qwen-direct"]

[backends.auggie]
enabled = true
model = "GPT-5"

[backends.claude]
enabled = true
model = "sonnet"

[backends.codex]
enabled = true
model = "codex"

[backends.codex-mcp]
enabled = true
model = "codex-mcp"

# Provider Metadata Configuration
# ===============================
# Provider metadata is stored in a separate file: ~/.auto-coder/provider_metadata.toml
# This file contains detailed information about each provider including:
# - command: The command to execute the provider (e.g., "uvx")
# - args: Arguments to pass to the command (e.g., ["qwen-openai-proxy"])
# - description: Human-readable description of the provider
# - Uppercase settings: Provider-specific configuration exported as environment variables
#
# Environment Variable Handling:
# ------------------------------
# Uppercase settings from provider metadata are automatically exported during command
# execution and cleared when the command completes. This provides secure, scoped
# access to provider-specific configuration without modifying your system environment.
#
# Example provider_metadata.toml:
# -------------------------------
# [qwen.qwen-open-router]
# command = "uvx"
# args = ["qwen-openai-proxy"]
# description = "Qwen via OpenRouter API"
# OPENROUTER_API_KEY = "your-openrouter-key"
#
# [qwen.qwen-azure]
# command = "uvx"
# args = ["qwen-azure-proxy"]
# description = "Qwen via Azure OpenAI"
# AZURE_ENDPOINT = "https://your-endpoint.openai.azure.com"
# AZURE_API_VERSION = "2024-02-15-preview"
# AZURE_API_KEY = "your-azure-key"
#
# [qwen.qwen-direct]
# command = "uvx"
# args = ["qwen-direct"]
# description = "Direct Qwen API access"
# QWEN_API_KEY = "your-qwen-api-key"
#
# [gemini.gemini-direct]
# command = "uvx"
# args = ["gemini-direct"]
# description = "Direct Gemini API access"
# GEMINI_API_KEY = "your-gemini-key"
#
# Notes:
# - Provider metadata is optional and the system degrades gracefully if no providers are configured
# - Provider rotation is automatic when usage limits are hit (AutoCoderUsageLimitError)
# - The BackendProviderManager tracks provider state and enables rotation
# - Works across all backends (Qwen, Gemini, Claude, etc.) via the shared provider system
# - Provider metadata file uses section format: [<backend>.<provider-name>]
#   (e.g., [qwen.qwen-open-router], [gemini.gemini-direct])